<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: white; }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
        .info { color: blue; }
        .warning { color: orange; }
        #output { border: 1px solid #ccc; padding: 10px; margin: 10px 0; max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>AV Master Game - Debug Test</h1>
    <div id="output"></div>
    
    <script type="module">
        const output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            div.className = type;
            output.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        log('Starting comprehensive debug test...', 'info');
        
        // Test 1: Check if modules can be imported
        try {
            log('Step 1: Testing module imports...', 'info');
            
            const { AudioSystem } = await import('./js/modules/AudioSystem.js');
            log('✓ AudioSystem imported successfully', 'success');
            
            const { getLevelData, LEVEL_ORDER } = await import('./js/data/LevelData.js');
            log('✓ LevelData imported successfully', 'success');
            
            const { getConnectorColor, calculateRequiredConnections } = await import('./js/utils/Helpers.js');
            log('✓ Helpers imported successfully', 'success');
            
            const { AVMasterGame } = await import('./js/core/GameEngine.js');
            log('✓ GameEngine imported successfully', 'success');
            
            // Test 2: Try to create game instance
            log('Step 2: Testing game instantiation...', 'info');
            const game = new AVMasterGame();
            log('✓ Game instantiated successfully', 'success');
            
            // Test 3: Check game properties
            log('Step 3: Checking game properties...', 'info');
            if (game.currentScreen) {
                log(`✓ currentScreen: ${game.currentScreen}`, 'success');
            } else {
                log('✗ currentScreen is missing', 'error');
            }
            
            if (game.gameState) {
                log(`✓ gameState.score: ${game.gameState.score}`, 'success');
                log(`✓ gameState.lives: ${game.gameState.lives}`, 'success');
            } else {
                log('✗ gameState is missing', 'error');
            }
            
            if (game.audioSystem) {
                log('✓ audioSystem initialized', 'success');
            } else {
                log('✗ audioSystem is missing', 'error');
            }
            
            // Test 4: Try to call init() method
            log('Step 4: Testing init() method...', 'info');
            try {
                game.init();
                log('✓ init() method called successfully', 'success');
            } catch (error) {
                log(`✗ init() method failed: ${error.message}`, 'error');
                log(`Stack trace: ${error.stack}`, 'error');
            }
            
            // Test 5: Check if DOM elements exist
            log('Step 5: Checking DOM elements...', 'info');
            const screens = document.querySelectorAll('.screen');
            log(`Found ${screens.length} screen elements`, screens.length > 0 ? 'success' : 'warning');
            
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                log('✓ loading-screen element found', 'success');
            } else {
                log('✗ loading-screen element not found', 'error');
            }
            
            const mainMenu = document.getElementById('main-menu');
            if (mainMenu) {
                log('✓ main-menu element found', 'success');
            } else {
                log('✗ main-menu element not found', 'error');
            }
            
            // Test 6: Check if game methods exist
            log('Step 6: Checking game methods...', 'info');
            const requiredMethods = ['showLoadingScreen', 'showMainMenu', 'loadLevel', 'switchScreen'];
            requiredMethods.forEach(method => {
                if (typeof game[method] === 'function') {
                    log(`✓ ${method} method exists`, 'success');
                } else {
                    log(`✗ ${method} method missing`, 'error');
                }
            });
            
            log('All tests completed!', 'success');
            
        } catch (error) {
            log(`✗ Critical error: ${error.message}`, 'error');
            log(`Stack trace: ${error.stack}`, 'error');
            console.error('Full error details:', error);
        }
    </script>
</body>
</html>
